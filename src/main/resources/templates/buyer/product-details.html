<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
    th:replace="~{fragments/base :: layout('Product Details - RevShop', ~{::section})}">

<head></head>

<body>
    <section class="container py-4">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/products}"
                        class="text-decoration-none custom-hover">Catalog</a></li>
                <li class="breadcrumb-item"><a th:href="@{/products(category=${product.category.name()})}"
                        class="text-decoration-none custom-hover" th:text="${product.category.name()}">Category</a></li>
                <li class="breadcrumb-item active" aria-current="page" th:text="${product.name}">Product</li>
            </ol>
        </nav>

        <div class="row g-5 bg-white p-4 p-md-5 rounded-4 shadow-sm border mb-5">
            <!-- Product Image Gallery -->
            <div class="col-md-6">
                <div class="position-relative mb-3">
                    <span th:if="${product.discountedPrice != null}"
                        class="badge bg-danger rounded-pill shadow-sm position-absolute top-0 start-0 m-3 fs-6">Sale</span>
                    <img th:src="${product.imageUrl != null ? product.imageUrl : 'https://dummyimage.com/600x500/dee2e6/6c757d.jpg&text=No+Image'}"
                        class="img-fluid rounded-4 shadow-sm w-100" alt="Product Image"
                        style="max-height: 500px; object-fit: cover;">
                </div>
            </div>

            <!-- Product Information -->
            <div class="col-md-6 d-flex flex-column">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h1 class="fw-bold text-dark mb-0" th:text="${product.name}">Product Name</h1>
                    <!-- Wishlist Form -->
                    <form th:action="@{/favorites/add}" method="post">
                        <input type="hidden" name="productId" th:value="${product.id}" />
                        <button type="submit" class="btn btn-outline-danger rounded-circle shadow-sm"
                            style="width: 45px; height: 45px;">
                            <i class="fa-solid fa-heart align-middle"></i>
                        </button>
                    </form>
                </div>

                <p class="text-secondary mb-3">Sold by: <span class="fw-bold text-dark"
                        th:text="${product.seller.name}">Seller Name</span></p>

                <div class="mb-4 d-flex align-items-center gap-3">
                    <div th:if="${product.discountedPrice != null}" class="d-flex align-items-baseline gap-2">
                        <span class="display-5 fw-bold text-primary"
                            th:text="'Rs.' + ${product.discountedPrice}">Rs.0.00</span>
                        <span class="fs-5 text-secondary text-decoration-line-through"
                            th:text="'Rs.' + ${product.price}">Rs.0.00</span>
                    </div>
                    <div th:unless="${product.discountedPrice != null}">
                        <span class="display-5 fw-bold text-primary" th:text="'Rs.' + ${product.price}">Rs.0.00</span>
                    </div>

                    <span class="badge bg-success rounded-pill px-3 py-2" th:if="${product.quantity > 0}"><i
                            class="fa-solid fa-check-circle me-1"></i> In Stock ([[${product.quantity}]])</span>
                    <span class="badge bg-danger rounded-pill px-3 py-2" th:if="${product.quantity <= 0}"><i
                            class="fa-solid fa-xmark-circle me-1"></i> Out of Stock</span>
                </div>

                <p class="text-secondary lh-lg mb-4" th:text="${product.description}">
                    Product description goes here. It provides a detailed overview of the product features,
                    specifications, and benefits.
                </p>

                <!-- Add to Cart Form -->
                <form th:action="@{/cart/add}" method="post" class="mt-auto bg-light p-4 rounded-4"
                    th:if="${product.quantity > 0}">
                    <input type="hidden" name="productId" th:value="${product.id}" />
                    <div class="row g-3 align-items-center">
                        <div class="col-auto">
                            <label for="quantity" class="col-form-label fw-bold">Quantity</label>
                        </div>
                        <div class="col-auto">
                            <input type="number" id="quantity" name="quantity" class="form-control text-center"
                                value="1" min="1" th:max="${product.quantity}" style="width: 80px;">
                        </div>
                        <div class="col mt-3 mt-md-0">
                            <button type="submit" class="btn btn-primary w-100 py-2 fw-bold shadow-sm rounded-pill">
                                <i class="fa-solid fa-cart-shopping me-2"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Reviews Section -->
        <div id="reviews" class="mt-5">
            <h3 class="fw-bold text-dark mb-4">Customer Reviews</h3>

            <div th:if="${reviews == null or reviews.isEmpty()}" class="alert alert-light border py-4 text-center">
                <p class="mb-0 text-secondary">No reviews yet. Be the first to review this product!</p>
            </div>

            <div class="row g-4">
                <div class="col-lg-8">
                    <div th:each="review : ${reviews}" class="card border-0 shadow-sm rounded-4 mb-3">
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="fw-bold mb-0"
                                    th:text="${review.user != null ? review.user.name : 'Anonymous'}">User Name</h6>
                                <div class="text-warning">
                                    <i th:each="i : ${#numbers.sequence(1, 5)}" class="fa-star"
                                        th:classappend="${review.rating != null and i <= review.rating ? 'fa-solid' : 'fa-regular'}"></i>
                                </div>
                            </div>
                            <p class="text-secondary small mb-2"
                                th:text="${review.createdAt != null ? #temporals.format(review.createdAt, 'MMM dd, yyyy') : ''}">
                                Date</p>
                            <p class="text-dark mb-0" th:text="${review.comment}">Review comment goes here.</p>
                        </div>
                    </div>
                </div>

                <!-- Add Review Form -->
                <div class="col-lg-4">
                    <div class="card border-0 shadow-sm rounded-4 position-sticky" style="top: 100px;">
                        <div class="card-header bg-white border-bottom py-3">
                            <h5 class="mb-0 fw-bold">Write a Review</h5>
                        </div>
                        <div class="card-body p-4">
                            <form th:action="@{/product/review}" method="post" th:object="${newReview}">
                                <input type="hidden" name="productId" th:value="${product.id}" />
                                <div class="mb-3">
                                    <label class="form-label fw-bold small">Rating</label>
                                    <select th:field="*{rating}" class="form-select rounded-3" required>
                                        <option value="5">5 Stars - Excellent</option>
                                        <option value="4">4 Stars - Good</option>
                                        <option value="3">3 Stars - Average</option>
                                        <option value="2">2 Stars - Poor</option>
                                        <option value="1">1 Star - Very Poor</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold small">Comment</label>
                                    <textarea th:field="*{comment}" class="form-control rounded-3" rows="4" required
                                        placeholder="What did you like or dislike?"></textarea>
                                </div>
                                <button type="submit"
                                    class="btn btn-primary w-100 rounded-pill fw-bold shadow-sm">Submit Review</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>

</html>