<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
    th:replace="~{fragments/base :: layout('Catalog - RevShop', ~{::section})}">

<head></head>

<body>
    <section class="container py-4">
        <div class="row mb-4 align-items-center">
            <div class="col-md-6">
                <h2 class="fw-bold text-dark mb-0">Product Catalog</h2>
                <p class="text-secondary small mb-0">Browse our latest collection.</p>
            </div>
            <div class="col-md-6 text-md-end mt-3 mt-md-0">
                <div class="btn-group shadow-sm">
                    <button type="button" class="btn btn-outline-secondary btn-sm dropdown-toggle rounded-pill px-4"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa-solid fa-sort me-2"></i>Sort By
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end border-0 shadow">
                        <li><a class="dropdown-item" th:href="@{/products(sort='price_asc')}">Price: Low to High</a>
                        </li>
                        <li><a class="dropdown-item" th:href="@{/products(sort='price_desc')}">Price: High to Low</a>
                        </li>
                        <li><a class="dropdown-item" th:href="@{/products(sort='newest')}">Newest Arrivals</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Alert for Empty Results -->
        <div th:if="${products == null or products.isEmpty()}" class="alert alert-info py-5 text-center shadow-sm"
            role="alert">
            <i class="fa-solid fa-face-frown fs-1 text-primary mb-3"></i>
            <h4 class="alert-heading fw-bold">No Products Found</h4>
            <p>Try adjusting your search filters or browse other categories.</p>
            <a th:href="@{/products}" class="btn btn-primary rounded-pill px-4 mt-2">Clear Filters</a>
        </div>

        <div class="row g-4" th:if="${products != null and !products.isEmpty()}">
            <div class="col-md-4 col-lg-3" th:each="product : ${products}">
                <div class="card h-100 border-0 shadow-sm product-card">
                    <div class="position-absolute top-0 end-0 p-2 d-flex flex-column gap-2" style="z-index: 10;">
                        <span th:if="${product.discountedPrice != null}"
                            class="badge bg-danger rounded-pill shadow-sm">Sale</span>

                        <!-- Form directly to add to favorites -->
                        <form th:action="@{/favorites/add}" method="post">
                            <input type="hidden" name="productId" th:value="${product.id}" />
                            <button type="submit"
                                class="btn btn-light btn-sm rounded-circle shadow-sm custom-hover p-2 border-0"
                                data-bs-toggle="tooltip" title="Add to Wishlist">
                                <i class="fa-solid fa-heart text-secondary"></i>
                            </button>
                        </form>
                    </div>

                    <a th:href="@{/product/{id}(id=${product.id})}">
                        <img th:src="${product.imageUrl != null ? product.imageUrl : 'https://dummyimage.com/400x300/dee2e6/6c757d.jpg&text=No+Image'}"
                            class="card-img-top" alt="Product Image" style="height: 220px; object-fit: cover;">
                    </a>

                    <div class="card-body d-flex flex-column">
                        <a th:href="@{/product/{id}(id=${product.id})}"
                            class="text-decoration-none text-dark custom-hover">
                            <h5 class="card-title fw-bold text-truncate mb-1" th:text="${product.name}">Product Name
                            </h5>
                        </a>
                        <p class="text-secondary small mb-2"><i class="fa-solid fa-tag me-1 text-primary"></i> <span
                                th:text="${product.category.name()}">Category</span></p>

                        <div class="mt-auto pt-3 border-top d-flex justify-content-between align-items-center">
                            <div>
                                <div th:if="${product.discountedPrice != null}">
                                    <span class="fs-5 fw-bold text-dark"
                                        th:text="'Rs.' + ${product.discountedPrice}">Rs.0.00</span>
                                    <span class="text-secondary text-decoration-line-through small ms-1"
                                        th:text="'Rs.' + ${product.price}">Rs.0.00</span>
                                </div>
                                <div th:unless="${product.discountedPrice != null}">
                                    <span class="fs-5 fw-bold text-dark"
                                        th:text="'Rs.' + ${product.price}">Rs.0.00</span>
                                </div>
                            </div>

                            <!-- Add to Cart Form -->
                            <form th:action="@{/cart/add}" method="post" th:if="${product.quantity > 0}">
                                <input type="hidden" name="productId" th:value="${product.id}" />
                                <input type="hidden" name="quantity" value="1" />
                                <button type="submit" class="btn btn-primary btn-sm rounded-pill px-3 shadow-sm">
                                    <i class="fa-solid fa-cart-plus me-1"></i> Add
                                </button>
                            </form>
                            <span th:if="${product.quantity <= 0}" class="badge bg-secondary rounded-pill">Out of
                                Stock</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</body>

</html>